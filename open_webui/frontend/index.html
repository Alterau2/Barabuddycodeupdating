<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="/static/favicon.png" />
    <link rel="icon" type="image/png" href="/static/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg" />
    <link rel="shortcut icon" href="/static/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png" />
    <link rel="stylesheet" href="/static/assets/splash.css" />
    <link rel="stylesheet" href="/static/theme.css" />
    <link rel="stylesheet" href="/static/app.css" />

    <meta name="apple-mobile-web-app-title" content="Barabuddy AI" />
    <link rel="manifest" href="/manifest.json" crossorigin="use-credentials" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"/>
    <meta name="theme-color" content="#171717" />
    <meta name="robots" content="noindex,nofollow" />
    <meta name="description" content="Barabuddy AI" />
    <link rel="search" type="application/opensearchdescription+xml" title="Barabuddy AI" href="/opensearch.xml"/>
    <script src="/static/loader.js" defer></script>

    <script>
        function resizeIframe(obj) {
            obj.style.height = obj.contentWindow.document.documentElement.scrollHeight + 'px';
        }
    </script>

    <script>
        // Theme handling script
        (() => {
            const metaThemeColorTag = document.querySelector('meta[name="theme-color"]');
            const prefersDarkTheme = window.matchMedia('(prefers-color-scheme: dark)').matches;

            if (!localStorage?.theme) {
                localStorage.theme = 'light';
            }

            if (localStorage.theme === 'light') {
                document.documentElement.classList.add(prefersDarkTheme ? 'dark' : 'light');
                metaThemeColorTag.setAttribute('content', prefersDarkTheme ? '#171717' : '#ffffff');
            } else if (localStorage.theme === 'oled-dark') {
                document.documentElement.style.setProperty('--color-gray-800', '#101010');
                document.documentElement.style.setProperty('--color-gray-850', '#050505');
                document.documentElement.style.setProperty('--color-gray-900', '#000000');
                document.documentElement.style.setProperty('--color-gray-950', '#000000');
                document.documentElement.classList.add('dark');
                metaThemeColorTag.setAttribute('content', '#000000');
            } else if (localStorage.theme === 'light') {
                document.documentElement.classList.add('light');
                metaThemeColorTag.setAttribute('content', '#ffffff');
            } else if (localStorage.theme === 'her') {
                document.documentElement.classList.add('dark');
                document.documentElement.classList.add('her');
                metaThemeColorTag.setAttribute('content', '#983724');
            } else {
                document.documentElement.classList.add('dark');
                metaThemeColorTag.setAttribute('content', '#171717');
            }

            window.matchMedia('(prefers-color-scheme: dark)').addListener((e) => {
                if (localStorage.theme === 'system') {
                    if (e.matches) {
                        document.documentElement.classList.add('dark');
                        document.documentElement.classList.remove('light');
                        metaThemeColorTag.setAttribute('content', '#171717');
                    } else {
                        document.documentElement.classList.add('light');
                        document.documentElement.classList.remove('dark');
                        metaThemeColorTag.setAttribute('content', '#ffffff');
                    }
                }
            });

            function setSplashImage() {
                const logo = document.getElementById('logo');
                const logoHer = document.getElementById('logo-her');
                const isDarkMode = document.documentElement.classList.contains('dark');
                
                // Set initial logo with timestamp to prevent caching
                const timestamp = new Date().getTime();
                const baseUrl = `/static/barabuddy.png?v=${timestamp}`;
                const darkUrl = `/static/barabuddy-dark.png?v=${timestamp}`;
                
                logo.src = baseUrl;
                if (logoHer) logoHer.src = baseUrl;

                if (isDarkMode) {
                    const darkImage = new Image();
                    darkImage.src = darkUrl;

                    darkImage.onload = () => {
                        logo.src = darkUrl;
                        logo.style.filter = '';
                        if (logoHer) {
                            logoHer.src = darkUrl;
                            logoHer.style.filter = '';
                        }
                    };

                    darkImage.onerror = () => {
                        logo.src = baseUrl;
                        logo.style.filter = 'invert(1)';
                        if (logoHer) {
                            logoHer.src = baseUrl;
                            logoHer.style.filter = 'invert(1)';
                        }
                    };
                }
            }

            // Run on initial load
            document.addEventListener('DOMContentLoaded', setSplashImage);
            // Run after a delay to ensure it sticks
            setTimeout(setSplashImage, 100);
        })();
    </script>

    <title>Barabuddy AI</title>

    <link rel="modulepreload" href="/_app/immutable/entry/start.CBnRensT.js">
    <link rel="modulepreload" href="/_app/immutable/chunks/C0h0lmGK.js">
    <link rel="modulepreload" href="/_app/immutable/chunks/BDiUIGvQ.js">
    <link rel="modulepreload" href="/_app/immutable/chunks/0eAQ6-Fb.js">
    <link rel="modulepreload" href="/_app/immutable/entry/app.VLVKYCLk.js">
    <link rel="modulepreload" href="/_app/immutable/chunks/C1FmrZbK.js">
    <link rel="modulepreload" href="/_app/immutable/chunks/CMw2dQw9.js">
</head>

<body data-sveltekit-preload-data="hover">
    <div style="display: contents">
        <script>
            {
                __sveltekit_1xicl3p = {
                    base: ""
                };

                const element = document.currentScript.parentElement;

                Promise.all([
                    import("/_app/immutable/entry/start.CBnRensT.js"),
                    import("/_app/immutable/entry/app.VLVKYCLk.js")
                ]).then(([kit, app]) => {
                    kit.start(app, element);
                });
            }
        </script>
    </div>

    <!-- Splash Screen (only splash content inside) -->
    <div id="splash-screen">
        <img id="logo" class="main-logo" src="/static/barabuddy.png" alt="Barabuddy AI" />
        <div class="welcome-text">Welcome to Barabuddy AI</div>
        <div class="loading-message-container">
            <span id="loading-message" class="loading-message">Welcome to your personal Barabuddy AI companion...</span>
        </div>
        <div class="progress-container">
            <img id="logo-her" class="her-logo animate-pulse-fast" src="/static/barabuddy.png" alt="Barabuddy AI" />
            <div class="progress-wrapper">
                <div id="progress-background"></div>
                <div id="progress-bar"></div>
            </div>
        </div>
    </div>
    <!-- End Splash Screen -->

    <!-- Main App UI: Now outside of splash screen -->
    <div id="app-container">
        <!-- Left Sidebar -->
        <div class="sidebar">
            <div class="sidebar-item">
                <button class="sidebar-button"><span class="icon">üìù</span>New Chat</button>
            </div>
            <div class="sidebar-item">
                <button class="sidebar-button"><span class="icon">üìã</span>Notes</button>
            </div>
            <div class="sidebar-item">
                <button class="sidebar-button"><span class="icon">üíº</span>Workspace</button>
            </div>
            <div class="sidebar-item">
                <button class="sidebar-button"><span class="icon">üîç</span>Search</button>
            </div>
            <div class="chats-section">
                <div class="section-header">Chats</div>
                <div class="chat-item">Today</div>
                <div class="chat-group">Software Development Insights</div>
                <div class="chat-item">Yesterday</div>
                <div class="chat-group">Software Development Practices</div>
            </div>
            <div class="user-info">
                <div class="user-avatar">AL</div>
                <div class="user-name">Austen Low</div>
            </div>
        </div>
        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <select class="mode-selector">
                    <option>barabuddy-limited:latest</option>
                </select>
                <button class="set-default-btn">Set as default</button>
            </div>
            <!-- Chat Area -->
            <div class="chat-area">
                <div class="bot-message">
                    <img src="/static/barabuddy.png" class="bot-avatar" alt="BaraBuddy" />
                    <div class="message-content">
                        <h2>BaraBuddy</h2>
                        <div class="input-area">
                            <p>How can I help you today?</p>
                            <div class="code-interpreter">
                                <span class="icon">üíª</span>
                                Code Interpreter
                                <div class="action-buttons">
                                    <button class="action-btn">‚Üª</button>
                                    <button class="action-btn">‚Üí</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Suggested Queries -->
                <div class="suggested-queries">
                    <div class="suggestion-count">4 Suggested</div>
                    <div class="suggestion-item">
                        <h3>Help me study</h3>
                        <p>vocabulary for a college entrance exam</p>
                    </div>
                    <div class="suggestion-item">
                        <h3>Give me ideas</h3>
                        <p>for what to do with my kids' art</p>
                    </div>
                    <div class="suggestion-item">
                        <h3>Show me a code snippet</h3>
                        <p>of a website's sticky header</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Main App UI -->

    <!-- Loading Animation Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const splashScreen = document.getElementById('splash-screen');
            const appContainer = document.getElementById('app-container');
            const progressBar = document.getElementById('progress-bar');
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += 1;
                if (progressBar) {
                    progressBar.style.width = `${progress}%`;
                }
                if (progress >= 100) {
                    clearInterval(interval);
                }
            }, 20);

            window.addEventListener('load', () => {
                setTimeout(() => {
                    splashScreen.style.transition = 'opacity 0.5s ease-out';
                    splashScreen.style.opacity = '0';
                    setTimeout(() => {
                        splashScreen.style.display = 'none';
                        appContainer.style.display = 'flex'; // Show the main app
                    }, 500);
                }, 1000);
            });
        });
    </script>

    <!-- Theme Observer Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Watch for theme changes
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.attributeName === 'class') {
                        setSplashImage();
                    }
                });
            });
            
            observer.observe(document.documentElement, {
                attributes: true
            });
        });
    </script>
</body>
</html>
